
/*@cc_on
 // conditional IE < 9 only fix for IE lacking the 3rd argument in setTimeout()
 // https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setTimeout
 @if (@_jscript_version <= 9)
 (function(f){
 window.setTimeout =f(window.setTimeout);
 window.setInterval =f(window.setInterval);
 })(function(f){return function(c,t){var a=[].slice.call(arguments,2);return f(function(){c.apply(this,a)},t)}});
 @end
 @*/
(function(b){redux.field_objects=redux.field_objects||{};var a;if(!redux.field_objects.serialized_repeater){redux.field_objects.serialized_repeater={animationDuration:350,dragAndDropInProgress:false,isIE9:/MSIE 9/i.test(navigator.userAgent)}}redux.field_objects.serialized_repeater.init=function(c,d){if(!d){d=false}if(!c){c=b(document).find(".redux-group-tab:visible .redux-field-init.redux-container-serialized_repeater:visible")}c.each(function(e){var f=b(this);if(!f.hasClass("redux-field-container")){f=f.parents(".redux-field-container:first");if(!f){return}}var g=f.parents(".redux-container").data("opt-name");if(g===undefined){a=redux}else{a=redux.optName}if(!d&&f.is(":hidden")){return}if(f.hasClass("redux-field-init")){f.removeClass("redux-field-init");if(redux.field_objects.serialized_repeater.isIE9){f.addClass("redux-field-old-ie")}}else{return}redux.field_objects.serialized_repeater.updateInteractionHandlers(f.find("> .redux-serialized-repeater-row-container"));f.on("click","a.redux-serialized-repeater-add",redux.field_objects.serialized_repeater.onAddClick);f.on("click","a.redux-serialized-repeater-delete",redux.field_objects.serialized_repeater.onDeleteClick)})};redux.field_objects.serialized_repeater.onBoundTitleValueChange=function(c){function d(o){if(k>=m-f.length-n.length){return false}l.push(o);k+=o.length+e.length;return true}var j=b(c.target);var g=j.closest("fieldset.redux-field-container");var i=g.closest(".redux-container-serialized_repeater").find(".redux-serialized-repeater-add");var e=i.attr("data-bindtitleseparator");var f=i.attr("data-bindtitleprefix");var n=i.attr("data-bindtitlepostfix");var l=[];var k=0;var m=Number(i.attr("data-bindtitlelimit"));switch(g.attr("data-type")){case"radio":case"checkbox":j.closest("ul").find("label input:checked").each(function(){return d(b(this).parent().text())});break;case"button_set":g.find("input:checked + label > span").each(function(){return d(b(this).text())});break;case"image_select":j.closest("ul").find("label input:checked").each(function(){return d(b(this).parent().find("img").attr("alt"))});break;case"sortable":if(j.prop("type")=="text"){j.closest("ul").find("input").each(function(){return d(b(this).val())})}else{j.closest("ul").find("input:checked").each(function(){return d(b(this).parent().text())})}break;case"password":if(j.attr("type")=="text"){l.push(j.val())}else{return}break;case"select":case"select_image":j.find("option:selected").each(function(){return d(b(this).text())});break;case"slider":var h=g.find("select option:selected");if(h.length){h.each(function(){return d(b(this).val())})}else{g.find("input:hidden").each(function(){return d(b(this).val())})}break;case"switch":g.find("label.selected span").each(function(){return d(b(this).text())});break;case"option_slider":g.find(".redux-option-slider-label").each(function(){return d(b(this).text())});break;case"palette":g.find("input:checked").each(function(){return d(b(this).val())});break;case"textarea":l.push(j.val());break;case"dimensions":case"spacing":case"typography":g.find('input[type="hidden"],select:hidden > option:selected').each(function(){var o=b(this);if(!(o.hasClass("field-units")||o.hasClass("redux-font-clear")||o.hasClass("redux-typography-google")||o.hasClass("redux-typography-google-font"))){if(o.prop("tagName")=="OPTION"){return d(b(this).text())}else{return d(b(this).val())}}});break;case"color":if(j.prop("checked")){l.push(j.parent().text())}else{l.push(g.find("input.redux-color").val())}break;case"ace_editor":l.push(j.closest(".ace-wrapper").find("> textarea.ace-editor").val());break;case"ckeditor":break;default:j.closest("fieldset").find('input[type!="hidden"],textarea').each(function(){return d(b(this).val())});break}if(l.constructor===Array){l=l.filter(function(o){return o});l=l.join(e)}if(l){l=f+redux.field_objects.serialized_repeater.trim(l,m,i.attr("data-bindtitlemore"))+n;j.closest(".redux-serialized-repeater-row").find("> h3 .title").text(l)}else{j.closest(".redux-serialized-repeater-row").find("> h3 .title").html("&nbsp;")}return false};redux.field_objects.serialized_repeater.trim=function(c,e,d){if(c.length>e-d.length){return c.substr(0,e-d.length)+d}return c};redux.field_objects.serialized_repeater.updateInteractionHandlers=function(e){var c=e.find("> .redux-serialized-repeater-row:not(.ui-accordion)");if(c.length){var d=e.parent().find("> .redux-serialized-repeater-add");var g=d.attr("data-accordionstyle");var h=d.attr("data-accordionstate");var f=false;redux.field_objects.serialized_repeater.forceAccordionPaneClosing=false;c.each(function(){var i=false;switch(h){case"all":i=0;break;case"first":if(!f){f=true;i=0}break;case"closed":break}b(this).accordion({header:"> h3",collapsible:true,active:i,animate:200,heightStyle:"content",activate:function(j,k){b.redux.initFields()},beforeActivate:function(n,p){if(redux.field_objects.serialized_repeater.dragAndDropInProgress){return false}if(redux.field_objects.serialized_repeater.forceAccordionPaneClosing){return true}var j=b(this);var m=j.accordion("option","active")!==false;var k=j.closest(".redux-container-serialized_repeater").find("> .redux-serialized-repeater-add");var l=k.attr("data-accordionstyle");var o=k.attr("data-accordionstate");if(l==="single"&&m){return false}if(l==="single"||l==="collapsible"){redux.field_objects.serialized_repeater.closeAllAccordionPanes(j.parent(),j)}}}).removeClass("ui-widget")})}if(e.hasClass("ui-sortable")){e.sortable("refresh")}else{e.sortable({start:redux.field_objects.serialized_repeater.onSortableStart,update:redux.field_objects.serialized_repeater.onSortableUpdate,stop:redux.field_objects.serialized_repeater.onSortableStop,placeholder:"sortable-placeholder",handle:"> .sort-handle, > h3 > .sort-handle",revert:120,items:"> .redux-serialized-repeater-row",tolerance:"pointer",distance:3,delay:100,scroll:false,})}e.find("> .redux-serialized-repeater-row.bind-title").each(function(){b(this).find("> fieldset > fieldset").each(function(){var i=b(this);if(["text","textarea","password","radio"].indexOf(i.attr("data-type"))!==-1){i.removeClass("redux-field-init")}if(i.hasClass("bind-title")){redux.field_objects.serialized_repeater.updateBindTitleHandlers(b(this))}})})};redux.field_objects.serialized_repeater.updateBindTitleHandlers=function(d){if(d.hasClass("redux-field-init")){if(!d.attr("data-updateinteractioninterval")){if(d.is(":hidden")){redux.field_objects.serialized_repeater.init(d,true)}d.attr("data-updateinteractioninterval",setInterval(function(){redux.field_objects.serialized_repeater.updateBindTitleHandlers(d)},1000))}}else{var g=d.attr("data-updateinteractioninterval");if(g){clearInterval(g);d.removeAttr("data-updateinteractioninterval")}var c=false;var f=b._data(d.get(0),"events");if(f){for(var e in f){if((e==="change"||e==="keyup")&&f.hasOwnProperty(e)){if(f[e][0]&&f[e][0].handler===redux.field_objects.serialized_repeater.onBoundTitleValueChange){c=true;break}}}}if(!c){d.on("change keyup",redux.field_objects.serialized_repeater.onBoundTitleValueChange);d.find("input:first,textarea:first,select:first").trigger("change")}}};redux.field_objects.serialized_repeater.openAccordionPane=function(c){var f=c.accordion("option","active")!==false;var d=c.closest(".redux-container-serialized_repeater").find("> .redux-serialized-repeater-add");var e=d.attr("data-accordionstyle");var g=d.attr("data-accordionstate");if(!f){c.accordion("option","active",0)}if(e==="single"||e==="collapsible"){redux.field_objects.serialized_repeater.closeAllAccordionPanes(c.parent(),c)}};redux.field_objects.serialized_repeater.closeAccordionPane=function(c,d){redux.field_objects.serialized_repeater.forceAccordionPaneClosing=d;c.accordion("option","active",false);redux.field_objects.serialized_repeater.forceAccordionPaneClosing=false};redux.field_objects.serialized_repeater.closeAllAccordionPanes=function(c,d){c.find("> .redux-serialized-repeater-row").each(function(){var e=b(this);if(!e.is(d)){redux.field_objects.serialized_repeater.closeAccordionPane(e,true)}else{}})};redux.field_objects.serialized_repeater.onSortableStart=function(c,d){redux.field_objects.serialized_repeater.dragAndDropInProgress=true;d.item.parent().addClass("sorting").css("padding-bottom",d.item.height()+"px");d.placeholder.append('<div class="content"></div>')};redux.field_objects.serialized_repeater.onSortableUpdate=function(e,f){var d=f.item.closest(".redux-container-serialized_repeater").find("> .redux-serialized-repeater-add");var c=d.attr("data-rootid");var g=d.attr("data-settingsid");var h=b("#"+g+"-"+c);redux.field_objects.serialized_repeater.renumberRows(h.find("> .redux-serialized-repeater-row-container"))};redux.field_objects.serialized_repeater.onSortableStop=function(d,e){redux.field_objects.serialized_repeater.dragAndDropInProgress=false;var c=e.item.parent();c.removeClass("sorting size-small size-medium size-large").addClass("sort-stop").css("padding-bottom",0);setTimeout(function(f){f.removeClass("sort-stop")},310,c)};redux.field_objects.serialized_repeater.removeNumberedBrackets=function(c){return c.replace(/\[(\d+)\]/g,"")};redux.field_objects.serialized_repeater.getRowToInsert=function(d,k){var c=d.find("> .redux-serialized-repeater-row-container").attr("data-fieldname");if(k!=c){c=redux.field_objects.serialized_repeater.removeNumberedBrackets(c)}if(k==c){var e=d.find("> .redux-serialized-repeater-row-container  > .redux-serialized-repeater-row");e.find('> fieldset > fieldset[data-type="serialized_repeater"] > .redux-serialized-repeater-row-container > .redux-serialized-repeater-row').remove();return e}var j=d.find('> .redux-serialized-repeater-row-container > .redux-serialized-repeater-row > fieldset > fieldset[data-type="serialized_repeater"]');for(var g=0,h=j.length;g<h;g++){var f=redux.field_objects.serialized_repeater.getRowToInsert(b(j[g]),k);if(f!==false){return f}}return false};redux.field_objects.serialized_repeater.onAddClick=function(e){e.stopImmediatePropagation();var l=b(this);var m=l.attr("data-rootid");var p=l.attr("data-settingsid");var o=l.attr("data-fieldname");var g=Number(l.attr("data-limit"));var d=Number(l.attr("data-level"));var k=Number(l.attr("data-count"));var c=Number(l.attr("data-counter"));var i=l.attr("data-displaytype");if(g>0&&k>=g){return false}if(!a.serialized_repeater[m]){return false}var h=a.serialized_repeater[m];if(!h.htmlDataNewReplacementDone){h.htmlDataNewReplacementDone=true;h.html=b(b.parseHTML(h.html)[0]);h.html.find(".redux-serialized-repeater-row").attr("data-new","true")}var f=b("#"+p+"-"+m);var j=h.html.clone();j=redux.field_objects.serialized_repeater.getRowToInsert(j,redux.field_objects.serialized_repeater.removeNumberedBrackets(o));var n=l.parent().find("> .redux-serialized-repeater-row-container");n.append(j);redux.field_objects.serialized_repeater.renumberRows(f.find("> .redux-serialized-repeater-row-container"));redux.field_objects.serialized_repeater.updateInteractionHandlers(n);if(i=="accordion"){redux.field_objects.serialized_repeater.openAccordionPane(j)}n.addClass("animating");j.addClass("initially-created");setTimeout(function(){j.addClass("making-visible")},1);setTimeout(function(){j.removeClass("initially-created making-visible");if(n.find("> .redux-serialized-repeater-row.initially-created, > .redux-serialized-repeater-row.initially-deleted").length==0){n.removeClass("animating")}},redux.field_objects.serialized_repeater.animationDuration+10);b.redux.initFields();if(g>0&&k>=g-1){if(l.hasClass("button")){l.addClass("button-disabled")}l.attr("data-disabled","true")}return false};redux.field_objects.serialized_repeater.onDeleteClick=function(e){e.stopImmediatePropagation();redux_change(b(this));var m=b(this);if(m.attr("data-disabled")=="true"){return false}var l=m.closest(".redux-container-serialized_repeater").find("> .redux-serialized-repeater-add");var n=l.attr("data-rootid");var p=l.attr("data-settingsid");var g=Number(l.attr("data-limit"));var d=Number(l.attr("data-level"));var i=Number(l.attr("data-count"));var c=Number(l.attr("data-counter"));var h=l.attr("data-displaytype");var f=b("#"+p+"-"+n);var j=m.closest(".redux-serialized-repeater-row");var o=j.parent();if(m.hasClass("button")){m.addClass("button-disabled")}m.attr("data-disabled","true");l.attr("data-count",--i);if(h=="accordion"){if(j.siblings().length){var k=j.next();if(!k.length){k=j.prev()}setTimeout(function(){redux.field_objects.serialized_repeater.openAccordionPane(k)},redux.field_objects.serialized_repeater.animationDuration/4)}}o.addClass("animating");j.addClass("initially-deleting");j.find("> fieldset").delay(100).slideUp(redux.field_objects.serialized_repeater.animationDuration);setTimeout(function(){j.addClass("making-invisible")},1);setTimeout(function(){j.remove();redux.field_objects.serialized_repeater.renumberRows(f.find("> .redux-serialized-repeater-row-container"));if(g>0&&i<g){l.removeClass("button-disabled")}if(o.find("> .redux-serialized-repeater-row.initially-created, > .redux-serialized-repeater-row.initially-deleting").length==0){o.removeClass("animating")}},redux.field_objects.serialized_repeater.animationDuration+100);return false};redux.field_objects.serialized_repeater.renumberRows=function(j){var h=j.parent().find("> .redux-serialized-repeater-add");var i=h.attr("data-rootid");var k=h.attr("data-settingsid");var e=Number(h.attr("data-limit"));var d=Number(h.attr("data-level"));var g=Number(h.attr("data-count"));var c=Number(h.attr("data-counter"));var f=a.serialized_repeater[i];f.level=f.level||[];f.level[d]={"$addButton":h,currentRowNumber:0};j.find("> .redux-serialized-repeater-row").each(function(m){function p(r){var q=/{{index-(\d+)}}/g;r=r.replace(q,function(t,v){var s=f.level[v].$addButton.attr("data-count");var u=f.level[v].$addButton.attr("data-counter");return u});return r}var l=false;var o=b(this);f.level[d].currentRowNumber=m;if(o.attr("data-new")=="true"){o.removeAttr("data-new");l=true;h.attr("data-count",++g);h.attr("data-counter",++c)}var n=o.find("input,select,textarea").filter(function(){return b(this).parents(".redux-serialized-repeater-row").length==(d+1)});n.each(function(B){var r=b(this);var F=r.closest(".redux-container-serialized_repeater").find("> .redux-serialized-repeater-add");var z=r.closest(".redux-field-container").attr("data-type");var q=r.attr("name");if(q){var w="";if(q.substr(-2)=="[]"){w="[]"}var D=/\[([^\]]+)\]/g;var y=[];var x=D.exec(q);while(x!=null){y.push(x[1]);x=D.exec(q)}var C=k;var s=-1;var E=0;for(var v=0,A=y.length;v<A;v++){var q=y[v];if(b.isNumeric(y[v])){if(v+1<y.length){++s;if(s==d){q=m}else{q=f.level[E++].currentRowNumber}}else{}}C+="["+q+"]"}C+=w;r.attr("name",C);if(z=="multi_text"){var u=r.closest(".redux-field-container").find(".redux-multi-text-add");if(u.attr("data-name").indexOf("[99999]")!==-1){u.attr("data-name",C)}}}if(l){var t=r.closest(".redux-field-container");if(t.prop("id")){t.prop("id",p(t.prop("id")))}if(t.attr("data-id")){t.attr("data-id",p(t.attr("data-id")))}t.find('*[id*="{{index-"],*[for*="{{index-"],*[rel*="{{index-"],*[class*="{{index-"],*[data-id*="{{index-"]').each(function(){var M=b(this);var L=M.prop("id");var K=M.attr("data-id");var H=M.attr("data-block-id");var J=M.prop("for");var G=M.attr("rel");var I=M.prop("class");if(L){M.prop("id",p(L))}if(K){M.attr("data-id",p(K))}if(H){M.attr("data-block-id",p(H))}if(J){M.prop("for",p(J))}if(G){M.attr("rel",p(G))}if(I){M.prop("class",p(I))}})}});b(this).find("> fieldset > fieldset.redux-container-serialized_repeater").each(function(r){var q=b(this);if(q.prop("id")){q.prop("id",p(q.prop("id")))}if(q.attr("data-id")){q.attr("data-id",p(q.attr("data-id")))}redux.field_objects.serialized_repeater.renumberRows(b(this).find("> .redux-serialized-repeater-row-container"))})});if(d===0){f.level=[]}}})(jQuery);