
(function(b){redux.field_objects=redux.field_objects||{};redux.field_objects.repeater=redux.field_objects.repeater||{};var a;redux_hook(b.redux,"check_dependencies",function(d,e,c){if(b(c).hasClass("repeater")){console.log(c)}});redux.field_objects.repeater.sort_repeaters=function(c){if(!c.hasClass("redux-container-repeater")){c=c.parents(".redux-container-repeater:first")}c.find(".redux-repeater-accordion-repeater").each(function(d){var i=b(this).attr("data-sortid");var e=b(this).find(".redux-field .repeater[name*='["+i+"]']");e.each(function(){b(this).attr("name",b(this).attr("name").replace("["+i+"]","["+d+"]"))});var h=b(this).find(".ui-accordion-header");var f=h.attr("id").split("-header-");h.attr("id",f[0]+"-header-"+d);f=h.attr("aria-controls").split("-panel-");h.attr("aria-controls",f[0]+"-panel-"+d);var g=b(this).find(".ui-accordion-content");var f=g.attr("id").split("-panel-");g.attr("id",f[0]+"-panel-"+d);f=g.attr("aria-labelledby").split("-header-");g.attr("aria-labelledby",f[0]+"-header-"+d)})};redux.field_objects.repeater.init=function(c){if(!c){c=b(document).find(".redux-group-tab:visible").find(".redux-container-repeater:visible")}b(c).each(function(m){var e=b(this);var l=e;if(!e.hasClass("redux-field-container")){l=e.parents(".redux-field-container:first")}if(l.is(":hidden")){return}if(l.hasClass("redux-field-init")){l.removeClass("redux-field-init")}else{return}var l=e;if(!e.hasClass("redux-field-container")){l=e.parents(".redux-field-container:first")}var n=e.parents(".redux-container").data("opt-name");if(n===undefined){a=redux}else{a=redux.optName}var j=l.attr("data-id");var i=e.find(".redux-repeater-accordion-repeater:last-child");a.repeater[j].blank=i.clone().wrap("<p>").parent().html();if(l.hasClass("redux-container-repeater")){l.addClass("redux-field-init")}if(l.hasClass("redux-field-init")){l.removeClass("redux-field-init")}else{return}var d=e.find(".redux-repeater-accordion");var g=Boolean(d.data("panels-closed"));var f;if(g===true){f=Boolean(false)}else{f=parseInt(0)}var h=e.find(".redux-repeater-accordion").accordion({header:"> div > fieldset > h3",collapsible:true,active:f,beforeActivate:function(o,p){if(typeof reduxRepeaterAccordionBeforeActivate=="function"){reduxRepeaterAccordionBeforeActivate(b(this),e,o,p)}},activate:function(o,p){b.redux.initFields();if(typeof reduxRepeaterAccordionActivate=="function"){reduxRepeaterAccordionActivate(b(this),e,o,p)}},heightStyle:"content",icons:{header:"ui-icon-plus",activeHeader:"ui-icon-minus"}});if(a.repeater[j].sortable==1){h.sortable({axis:"y",handle:"h3",connectWith:".redux-repeater-accordion",placeholder:"ui-state-highlight",start:function(p,o){o.placeholder.height(o.item.height());o.placeholder.width(o.item.width())},stop:function(o,p){p.item.children("h3").triggerHandler("focusout");redux.field_objects.repeater.sort_repeaters(b(this))}})}else{h.find("h3.ui-accordion-header").css("cursor","pointer")}e.find(".redux-repeater-accordion-repeater .bind_title").on("change keyup",function(o){var p;if(b(o.target).find(":selected").text().length>0){p=b(o.target).find(":selected").text()}else{p=b(o.target).val()}b(this).closest(".redux-repeater-accordion-repeater").find(".redux-repeater-header").text(p)});e.find(".redux-repeaters-remove").live("click",function(){redux_change(b(this));var p=b(this).parents(".redux-container-repeater:first");var o=p.attr("data-id");a.repeater[o].blank=b(this).parents(".redux-repeater-accordion-repeater:first").clone(true,true);b(this).parents(".redux-repeater-accordion-repeater:first").slideUp("medium",function(){b(this).remove();redux.field_objects.repeater.sort_repeaters(e);if(a.repeater[o].limit!=""){var q=p.find(".redux-repeater-accordion-repeater").length;if(q<a.repeater[o].limit){p.find(".redux-repeaters-add").removeClass("button-disabled")}}p.find(".redux-repeater-accordion-repeater:last .ui-accordion-header").click()})});var k=e.find(".redux-repeater-accordion-repeater");if(k.hasClass("close-me")){e.find(".redux-repeaters-remove").click()}String.prototype.reduxReplaceAll=function(p,o){return this.replace(new RegExp(p.replace(/[.^$*+?()[{\|]/g,"\\$&"),"g"),o)};e.find(".redux-repeaters-add").click(function(){if(b(this).hasClass("button-disabled")){return}var r=b(this).parent().find(".redux-repeater-accordion:first");var s=r.find(".redux-repeater-accordion-repeater").length;var q=r.attr("data-id");if(a.repeater[q].limit!=""){if(s>=a.repeater[q].limit){b(this).addClass("button-disabled");return}}s++;var t=r.find(".redux-repeater-accordion-repeater").size();if(r.find(".redux-repeater-accordion-repeater:last").find(".ui-accordion-header").hasClass("ui-state-active")){r.find(".redux-repeater-accordion-repeater:last").find(".ui-accordion-header").click()}var o=r.find(".redux-repeater-accordion-repeater:last").clone(true,true);if(o.length==0){o=a.repeater[q].blank}if(a.repeater[q]){a.repeater[q].count=e.find(".redux-repeater-header").length;var p=a.repeater[q].html.reduxReplaceAll("99999",t);b(o).find(".redux-repeater-header").text("")}o.find(".ui-accordion-content").html(p);b(r).append(o);redux.field_objects.repeater.sort_repeaters(o);var o=b(this).parent().find(".redux-repeater-accordion:first");o.find(".redux-repeater-accordion-repeater:last .ui-accordion-header").click();o.find(".redux-repeater-accordion-repeater:last .bind_title").on("change keyup",function(u){var v;if(b(u.target).find(":selected").text().length>0){v=b(u.target).find(":selected").text()}else{v=b(u.target).val()}b(this).closest(".redux-repeater-accordion-repeater").find(".redux-repeater-header").text(v)});if(a.repeater[q].limit>0&&s>=a.repeater[q].limit){b(this).addClass("button-disabled")}if(g===true){if(s>=2){e.find(".redux-repeater-accordion").accordion("option",{active:false})}}})})}})(jQuery);