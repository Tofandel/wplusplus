!function(e){"use strict";var i;redux.field_objects=redux.field_objects||{},redux.field_objects.multi_media=redux.field_objects.multi_media||{},redux.field_objects.multi_media.mainID="",redux.field_objects.multi_media.init=function(i){i||(i=e(document).find(".redux-multi-media-container")),e(i).each(function(){var i=e(this),t=i;i.hasClass("redux-field-container")||(t=i.parents(".redux-field-container:first")),t.hasClass("redux-field-init")&&(t.removeClass("redux-field-init"),i.find(".redux_remove_file_button").unbind("click").on("click",function(i){redux.field_objects.multi_media.removeFile(i,e(this).parents("fieldset.redux-field:first"),e(this))}),i.find(".redux_upload_button").unbind().on("click",function(i){redux.field_objects.multi_media.addFile(i,e(this).parents("fieldset.redux-field:first"),e(this))}),redux.field_objects.multi_media.modInit(i))})},redux.field_objects.multi_media.modInit=function(t){if(i=redux_multi_media_l10,redux.field_objects.multi_media.mainID=t.attr("data-id"),!0===Boolean(t.find(".redux-multi-media-container").data("dev-mode"))){var d=t.find(".redux-multi-media-container").data("version"),l=e("div.redux-timer").html();if(void 0!==l)-1===l.indexOf("Multi Media Selector")&&e("div.redux-timer").html(l+"<br/>Multi Media Selector extension v."+d)}},redux.field_objects.multi_media.removeErrMsgs=function(){e("#"+redux.field_objects.multi_media.mainID+" .attach_list li.redux-file-exists").each(function(i,t){e(t).remove()}),e("#"+redux.field_objects.multi_media.mainID+" .attach_list li.redux-max-limit").each(function(i,t){e(t).remove()})},redux.field_objects.multi_media.selExists=function(i){var t=!1;return e("#"+redux.field_objects.multi_media.mainID+" .attach_list li").each(function(d,l){0!==e(l).find("input#filelist-"+i).length&&(t=!0)}),t},redux.field_objects.multi_media.addFile=function(t,d,l){var a,r;t.preventDefault();var n=!0,s=l.prev("input").attr("id"),u=e("#"+s),m=u.attr("name");if(a)a.open();else{redux.field_objects.multi_media.removeErrMsgs();var o,f=e(d).find(".library-filter").data("lib-filter"),c=e(d).find(".redux-multi-media-container").data("max-file-upload");void 0!==f&&""!==f&&(r=[],f=decodeURIComponent(f),f=JSON.parse(f),e.each(f,function(e,i){r.push(i)})),(a=wp.media({multiple:!0,title:i.title,library:{type:r},button:{text:i.upload_file}})).on("select",function(){var t=0,l=a.state().get("selection").toJSON();u.val(l.url),e("#"+s+"_id").val(l.id);var r=[],f=[],_=[],h=[],x=e("#"+redux.field_objects.multi_media.mainID+" .attach_list").children().length;e(l).each(function(){if(c<=0||t+x<c){if(redux.field_objects.multi_media.selExists(this.id)){var e=i.dup_warn;return e=e.replace("%s","<strong>"+this.filename+"</strong>"),n='<li class="redux-file-exists">'+e+"</li>",h.push(n),o=!1,!0}this.type&&"image"===this.type?(n='<li class="img_status"><img width="50" height="50" src="'+this.url+'" class="attachment-50x50" alt="'+this.filename+'"><p><a href="#" class="redux_remove_file_button" rel="'+s+"["+this.id+']">'+i.remove_image+'</a></p><input type="hidden" id="filelist-'+this.id+'" name="'+m+"["+this.id+']" value="'+this.url+'"></li>',_.push(n),o=!0):(n="<li>"+i.file+" <strong>"+this.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+i.download+'</a> / <a href="#" class="redux_remove_file_button" rel="'+s+"["+this.id+']">'+i.remove_file+'</a>)<input type="hidden" id="filelist-'+this.id+'" name="'+m+"["+this.id+']" value="'+this.url+'"></li>',f.push(n)),t++}else{var d=i.max_warn;d=d.replace("%s","<strong>"+c+"</strong>"),n='<li class="redux-max-limit">'+d+"</li>",h.push(n)}}),e.isEmptyObject(_)||e(_).each(function(e,i){r.push(i),o=!0}),e.isEmptyObject(f)||e(f).each(function(e,i){r.push(i),o=!0}),e.isEmptyObject(h)||e(h).each(function(e,i){r.push(i)}),e(r).each(function(){u.siblings(".redux_media_status").slideDown().append(this)}),a.close(),!0===o&&redux_change(e(d).find(".redux_media_status"))}),a.open()}},redux.field_objects.multi_media.removeFile=function(i,t,d){i.preventDefault();var l=d;if(l.is(".attach_list .redux_remove_file_button"))return l.parents("li").remove(),redux_change(e(t).find(".redux_media_status")),!1;var a=l.attr("rel"),r=l.parents(".img_status");return t.find("input#"+a).val(""),t.find("input#"+a+"_id").val(""),r.length?r.html(""):l.parents(".redux_media_status").html(""),!1}}(jQuery);