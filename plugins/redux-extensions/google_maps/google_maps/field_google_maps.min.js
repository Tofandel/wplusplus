(function($){"use strict";redux=redux||{};redux.field_objects=redux.field_objects||{};redux.field_objects.google_maps=redux.field_objects.google_maps||{};var g_map,g_marker,g_autoComplete,g_LatLng;redux.field_objects.google_maps.init=function(selector){if(!selector){selector=$(document).find(".redux-group-tab:visible").find(".redux-container-google_maps:visible")}$(selector).each(function(i){var el=$(this);var parent=el;if(!el.hasClass("redux-field-container")){parent=el.parents(".redux-field-container:first")}if(parent.is(":hidden")){return}if(parent.hasClass("redux-field-init")){parent.removeClass("redux-field-init")}else{return}var containerID=el.find(".redux_framework_google_maps").attr("id");var delayRender=Boolean(el.find(".redux_framework_google_maps").data("delay-render"));redux.field_objects.google_maps.clickHandler(el);redux.field_objects.google_maps.initMap(el,i,containerID,delayRender);setTimeout(function(){$("#changetype-all").attr("checked","checked")},1)})};redux.field_objects.google_maps.clickHandler=function(el){el.find(".google_m_api_key_button").click(function(e){var wrapper=el.find(".google_m_api_key_wrapper");if(wrapper.is(":visible")){wrapper.slideUp("fast",function(){el.find("#google_m_api_key_input").focus()})}else{wrapper.slideDown("medium",function(){el.find("#google_m_api_key_input").focus()})}});el.find(".google_m_autocomplete").click(function(e){this.focus();this.select();e.preventDefault()})};redux.field_objects.google_maps.renderMap=function(el,mapClass){var containerID=el.find(".redux_framework_google_maps").attr("id");var autocomplete=containerID+"_autocomplete";var canvas=containerID+"_map_canvas";g_autoComplete=new google.maps.places.Autocomplete(document.getElementById(autocomplete),{types:["geocode"]});var scrollWheel=Boolean(mapClass.data("scroll-wheel"));var streetView=Boolean(mapClass.data("street-view"));var mapType=Boolean(mapClass.data("map-type"));var address=mapClass.data("address");address=decodeURIComponent(address);address=address.trim();var defLat=$("#"+canvas).data("default-lat");var defLong=$("#"+canvas).data("default-long");var defaultZoom=$("#"+canvas).data("default-zoom");var noLatLng=false;if(address!==""){if(defLat===""||defLong===""){noLatLng=true}}else{noLatLng=false}defLat=defLat?defLat:39.11676722061108;defLong=defLong?defLong:-100.47761000000003;if(noLatLng){var geocoder=new google.maps.Geocoder;geocoder.geocode({address:address},function(results,status){if(status===google.maps.GeocoderStatus.OK){g_LatLng=results[0].geometry.location;var mapOptions={center:g_LatLng,zoom:defaultZoom,streetViewControl:streetView,mapTypeControl:mapType,scrollwheel:scrollWheel,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM}};g_map=new google.maps.Map(document.getElementById(canvas),mapOptions);redux.field_objects.google_maps.renderControls(el,autocomplete,mapClass);var latitude=el.find("#"+containerID+"_latitude");latitude.val(results[0].geometry.location.lat());var longitude=el.find("#"+containerID+"_longitude");longitude.val(results[0].geometry.location.lng())}else{alert("Geocode was not successful for the following reason: "+status)}})}else{g_LatLng=new google.maps.LatLng(defLat,defLong);var mapOptions={center:g_LatLng,zoom:defaultZoom,streetViewControl:streetView,mapTypeControl:mapType,scrollwheel:scrollWheel,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM}};g_map=new google.maps.Map(document.getElementById(canvas),mapOptions);redux.field_objects.google_maps.renderControls(el,autocomplete,mapClass)}};redux.field_objects.google_maps.initMap=function(el,idx,containerID,delayRender){var mapClass=el.find(".redux_framework_google_maps");$(mapClass).attr("data-idx",idx);if(delayRender===true){return}if($("#"+containerID).hasClass("rendered")){return}var delayed=Boolean(mapClass.data("delay-render"));if(delayed===true){mapClass.addClass("rendered")}redux.field_objects.google_maps.renderMap(el,mapClass)};redux.field_objects.google_maps.renderControls=function(el,autoComplete,mapClass){var containerID=el.find(".redux_framework_google_maps").attr("id");var controls=containerID+"_type_selector";var input=document.getElementById(autoComplete);var types=document.getElementById(controls);g_map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);g_map.controls[google.maps.ControlPosition.TOP_LEFT].push(types);g_autoComplete=new google.maps.places.Autocomplete(input);g_autoComplete.bindTo("bounds",g_map);var markerTooltip=mapClass.data("marker-tooltip");markerTooltip=decodeURIComponent(markerTooltip);var infoWindow=new google.maps.InfoWindow;g_marker=new google.maps.Marker({position:g_LatLng,map:g_map,anchorPoint:new google.maps.Point(0,-29),draggable:true,title:markerTooltip,animation:google.maps.Animation.DROP});redux.field_objects.google_maps.addListeners(el,mapClass,g_marker,infoWindow)};redux.field_objects.google_maps.addListeners=function(el,mapClass,marker,infoWindow){var containerID=el.find(".redux_framework_google_maps").attr("id");var latitude=containerID+"_latitude";var longitude=containerID+"_longitude";var marker_info=containerID+"_marker_info";var geoAlert=mapClass.data("geo-alert");geoAlert=decodeURIComponent(geoAlert);google.maps.event.addListener(g_autoComplete,"place_changed",function(){infoWindow.close();marker.setVisible(false);var place=g_autoComplete.getPlace();if(!place.geometry){window.alert(geoAlert);return}if(place.geometry.viewport){g_map.fitBounds(place.geometry.viewport)}else{g_map.setCenter(place.geometry.location);g_map.setZoom(17)}marker.setIcon({url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)});marker.setPosition(place.geometry.location);marker.setVisible(true);var address="";if(place.address_components){address=[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" ")}infoWindow.setContent("<div><strong>"+place.name+"</strong><br>"+address);infoWindow.open(g_map,marker);redux.field_objects.google_maps.geoLocate();redux.field_objects.google_maps.fillInAddress(el,latitude,longitude)});redux.field_objects.google_maps.setupClickListener("changetype-all",[]);redux.field_objects.google_maps.setupClickListener("changetype-address",["address"]);redux.field_objects.google_maps.setupClickListener("changetype-establishment",["establishment"]);redux.field_objects.google_maps.setupClickListener("changetype-geocode",["geocode"]);google.maps.event.addListener(marker,"drag",function(event){document.getElementById(latitude).value=event.latLng.lat();document.getElementById(longitude).value=event.latLng.lng()});google.maps.event.addListener(marker,"dragend",function(event){redux_change(el.find(".redux_framework_google_maps"))});g_map.addListener("zoom_changed",function(){el.find(".google_m_zoom_input").val(g_map.getZoom())});var infoWindow=new google.maps.InfoWindow;google.maps.event.addListener(marker,"click",function(event){var infoValue=document.getElementById(marker_info).value;if(infoValue!==""){infoWindow.setContent(infoValue);infoWindow.open(g_map,g_marker)}})};redux.field_objects.google_maps.fillInAddress=function(el,latitude,longitude){var containerID=el.find(".redux_framework_google_maps").attr("id");var componentForm={street_number:"short_name",route:"long_name",locality:"long_name",administrative_area_level_1:"short_name",country:"long_name",postal_code:"short_name"};var place=g_autoComplete.getPlace();document.getElementById(latitude).value=place.geometry.location.lat();document.getElementById(longitude).value=place.geometry.location.lng();for(var component in componentForm){var component=containerID+"_"+component;document.getElementById(component).value="";document.getElementById(component).disabled=false}for(var i=0;i<place.address_components.length;i++){var addressType=place.address_components[i].types[0];if(componentForm[addressType]){var _d_addressType=containerID+"_"+addressType;var val=place.address_components[i][componentForm[addressType]];document.getElementById(_d_addressType).value=val}}};redux.field_objects.google_maps.setupClickListener=function(id,types){var radioButton=document.getElementById(id);google.maps.event.addDomListener(radioButton,"click",function(){g_autoComplete.setTypes(types)})};redux.field_objects.google_maps.geoLocate=function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){var geolocation=new google.maps.LatLng(position.coords.latitude,position.coords.longitude);var circle=new google.maps.Circle({center:geolocation,radius:position.coords.accuracy});g_autoComplete.setBounds(circle.getBounds())})}}})(jQuery);