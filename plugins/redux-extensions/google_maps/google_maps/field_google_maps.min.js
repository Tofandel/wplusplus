
(function(e){redux=redux||{};redux.field_objects=redux.field_objects||{};redux.field_objects.google_maps=redux.field_objects.google_maps||{};var b,a,d,c;redux.field_objects.google_maps.init=function(f){if(!f){f=e(document).find(".redux-group-tab:visible").find(".redux-container-google_maps:visible")}e(f).each(function(j){var l=e(this);var k=l;if(!l.hasClass("redux-field-container")){k=l.parents(".redux-field-container:first")}if(k.is(":hidden")){return}if(k.hasClass("redux-field-init")){k.removeClass("redux-field-init")}else{return}var g=l.find(".redux_framework_google_maps").attr("id");var h=Boolean(l.find(".redux_framework_google_maps").data("delay-render"));redux.field_objects.google_maps.clickHandler(l);redux.field_objects.google_maps.initMap(l,j,g,h);setTimeout(function(){e("#changetype-all").attr("checked","checked")},1)})};redux.field_objects.google_maps.clickHandler=function(f){f.find(".google_m_api_key_button").click(function(g){var h=f.find(".google_m_api_key_wrapper");if(h.is(":visible")){h.slideUp("fast",function(){f.find("#google_m_api_key_input").focus()})}else{h.slideDown("medium",function(){f.find("#google_m_api_key_input").focus()})}});f.find(".google_m_autocomplete").click(function(g){this.focus();this.select();g.preventDefault()})};redux.field_objects.google_maps.renderMap=function(h,m){var s=h.find(".redux_framework_google_maps").attr("id");var g=s+"_autocomplete";var i=s+"_map_canvas";d=new google.maps.places.Autocomplete((document.getElementById(g)),{types:["geocode"]});var t=Boolean(m.data("scroll-wheel"));var n=Boolean(m.data("street-view"));var j=Boolean(m.data("map-type"));var p=m.data("address");p=decodeURIComponent(p);p=p.trim();var f=e("#"+i).data("default-lat");var q=e("#"+i).data("default-long");var o=e("#"+i).data("default-zoom");var r=false;if(p!==""){if(f===""||q===""){r=true}}else{r=false}f=f?f:39.11676722061108;q=q?q:-100.47761000000003;if(r){var l=new google.maps.Geocoder();l.geocode({address:p},function(w,u){if(u===google.maps.GeocoderStatus.OK){c=w[0].geometry.location;var v={center:c,zoom:o,streetViewControl:n,mapTypeControl:j,scrollwheel:t,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM}};b=new google.maps.Map(document.getElementById(i),v);redux.field_objects.google_maps.renderControls(h,g,m);var y=h.find("#"+s+"_latitude");y.val(w[0].geometry.location.lat());var x=h.find("#"+s+"_longitude");x.val(w[0].geometry.location.lng())}else{alert("Geocode was not successful for the following reason: "+u)}})}else{c=new google.maps.LatLng(f,q);var k={center:c,zoom:o,streetViewControl:n,mapTypeControl:j,scrollwheel:t,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM}};b=new google.maps.Map(document.getElementById(i),k);redux.field_objects.google_maps.renderControls(h,g,m)}};redux.field_objects.google_maps.initMap=function(k,g,f,h){var j=k.find(".redux_framework_google_maps");e(j).attr("data-idx",g);if(h===true){return}if(e("#"+f).hasClass("rendered")){return}var i=Boolean(j.data("delay-render"));if(i===true){j.addClass("rendered")}redux.field_objects.google_maps.renderMap(k,j)};redux.field_objects.google_maps.renderControls=function(g,l,j){var n=g.find(".redux_framework_google_maps").attr("id");var m=n+"_type_selector";var k=document.getElementById(l);var i=document.getElementById(m);b.controls[google.maps.ControlPosition.TOP_LEFT].push(k);b.controls[google.maps.ControlPosition.TOP_LEFT].push(i);d=new google.maps.places.Autocomplete(k);d.bindTo("bounds",b);var f=j.data("marker-tooltip");f=decodeURIComponent(f);var h=new google.maps.InfoWindow();a=new google.maps.Marker({position:c,map:b,anchorPoint:new google.maps.Point(0,-29),draggable:true,title:f,animation:google.maps.Animation.DROP});redux.field_objects.google_maps.addListeners(g,j,a,h)};redux.field_objects.google_maps.addListeners=function(g,k,j,i){var n=g.find(".redux_framework_google_maps").attr("id");var m=n+"_latitude";var f=n+"_longitude";var h=n+"_marker_info";var l=k.data("geo-alert");l=decodeURIComponent(l);google.maps.event.addListener(d,"place_changed",function(){i.close();j.setVisible(false);var p=d.getPlace();if(!p.geometry){window.alert(l);return}if(p.geometry.viewport){b.fitBounds(p.geometry.viewport)}else{b.setCenter(p.geometry.location);b.setZoom(17)}j.setIcon(({url:p.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}));j.setPosition(p.geometry.location);j.setVisible(true);var o="";if(p.address_components){o=[(p.address_components[0]&&p.address_components[0].short_name||""),(p.address_components[1]&&p.address_components[1].short_name||""),(p.address_components[2]&&p.address_components[2].short_name||"")].join(" ")}i.setContent("<div><strong>"+p.name+"</strong><br>"+o);i.open(b,j);redux.field_objects.google_maps.geoLocate();redux.field_objects.google_maps.fillInAddress(g,m,f)});redux.field_objects.google_maps.setupClickListener("changetype-all",[]);redux.field_objects.google_maps.setupClickListener("changetype-address",["address"]);redux.field_objects.google_maps.setupClickListener("changetype-establishment",["establishment"]);redux.field_objects.google_maps.setupClickListener("changetype-geocode",["geocode"]);google.maps.event.addListener(j,"drag",function(o){document.getElementById(m).value=o.latLng.lat();document.getElementById(f).value=o.latLng.lng()});google.maps.event.addListener(j,"dragend",function(o){redux_change(g.find(".redux_framework_google_maps"))});b.addListener("zoom_changed",function(){g.find(".google_m_zoom_input").val(b.getZoom())});var i=new google.maps.InfoWindow();google.maps.event.addListener(j,"click",function(p){var o=document.getElementById(h).value;if(o!==""){i.setContent(o);i.open(b,a)}})};redux.field_objects.google_maps.fillInAddress=function(g,o,f){var q=g.find(".redux_framework_google_maps").attr("id");var n={street_number:"short_name",route:"long_name",locality:"long_name",administrative_area_level_1:"short_name",country:"long_name",postal_code:"short_name"};var j=d.getPlace();document.getElementById(o).value=j.geometry.location.lat();document.getElementById(f).value=j.geometry.location.lng();for(var p in n){var p=q+"_"+p;document.getElementById(p).value="";document.getElementById(p).disabled=false}for(var k=0;k<j.address_components.length;k++){var m=j.address_components[k].types[0];if(n[m]){var l=q+"_"+m;var h=j.address_components[k][n[m]];document.getElementById(l).value=h}}};redux.field_objects.google_maps.setupClickListener=function(h,f){var g=document.getElementById(h);google.maps.event.addDomListener(g,"click",function(){d.setTypes(f)})};redux.field_objects.google_maps.geoLocate=function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(g){var f=new google.maps.LatLng(g.coords.latitude,g.coords.longitude);var h=new google.maps.Circle({center:f,radius:g.coords.accuracy});d.setBounds(h.getBounds())})}}})(jQuery);