(function($){"use strict";redux.field_objects=redux.field_objects||{};redux.field_objects.css_layout=redux.field_objects.css_layout||{};redux.field_objects.css_layout.init=function(selector){if(!selector){selector=$(document).find(".redux-group-tab:visible").find(".redux-container-css_layout:visible")}$(selector).each(function(){var el=$(this);var parent=el;if(!el.hasClass("redux-field-container")){parent=el.parents(".redux-field-container:first")}if(parent.is(":hidden")){return}if(parent.hasClass("redux-field-init")){parent.removeClass("redux-field-init")}else{return}redux.field_objects.css_layout.modInit(el)})};redux.field_objects.css_layout.modInit=function(el){var dev_mode=Boolean(el.find(".redux-css-layout-container").data("dev-mode"));if(dev_mode==true){var ver=el.find(".redux-css-layout-container").data("version");var dev_html=$("div.redux-timer").html();if(dev_html!==undefined){var pos=dev_html.indexOf("CSS Layout");if(pos===-1){$("div.redux-timer").html(dev_html+"<br/>CSS Layout extension v."+ver)}}}var default_params={triggerChange:true,allowClear:false};var select2_handle=el.find(".redux-container-css_layout").find(".select2_params");if(select2_handle.size()>0){var select2_params=select2_handle.val();select2_params=JSON.parse(select2_params);default_params=$.extend({},default_params,select2_params)}el.find(".redux-style-css-layout-border").select2(default_params);var mainID=el.attr("data-id");el.find("#"+mainID+" .redux-color-css-layout-border").wpColorPicker({change:function(event,ui){redux_change($(this));var color=ui.color.toString();el.find("#"+mainID).find(".redux-css-layout-border").css({"border-color":color})}});el.find(".redux-style-css-layout-border").on("change",function(e){redux_change(el.find(".redux-css-layout-container"));var style=$(this).val();var mainID=el.attr("data-id");el.find("#"+mainID).find(".redux-css-layout-border").css({"border-style":style})});el.find(".css-layout-input").on("change",function(e){var value=$(this).val();var localUnit=redux.field_objects.css_layout.getUnit(value,el);var unit=localUnit!==""?localUnit:redux.field_objects.css_layout.defUnitVal($(this),el);value=value.replace(/[^\d.-]/g,"");if(value!==""&&$.isNumeric(value)){redux_change(el.find(".redux-css-layout-container"));$(this).val("");$(this).val(value+unit)}else{$(this).val("")}redux.field_objects.css_layout.updateShorthand($(this),el);if($(this).hasClass("redux-css-layout-input-radius")){var radius=$(this).val();var mainID=el.attr("data-id");el.find("#"+mainID).find(".redux-css-layout-border").css({"border-radius":radius})}})};redux.field_objects.css_layout.updateShorthand=function(selector,el){var levelArr=["margin","border","padding"];var posArr=["top","right","bottom","left"];var finalArr=[];var mainID=el.attr("data-id");$.each(levelArr,function(idx,val){if(selector.hasClass("redux-css-"+val)){$.each(posArr,function(index,value){finalArr[index]=el.find("#"+mainID).find(".redux-css-"+val+"-"+value).val();finalArr[index]=finalArr[index]===""?"0":finalArr[index]});var shorthand=finalArr[0]+" "+finalArr[1]+" "+finalArr[2]+" "+finalArr[3];el.find("#"+mainID).find(".redux-css-"+val+"-shorthand").val(shorthand)}})};redux.field_objects.css_layout.getUnit=function(str,el){var res="";var s=str.toLowerCase();var unitArr=$("#"+el.attr("data-id")).data("units");unitArr=decodeURIComponent(unitArr);unitArr=$.parseJSON(unitArr);$.each(unitArr,function(index,value){var len=s.indexOf(value);if(len!==-1){res=value;return false}});return res};redux.field_objects.css_layout.defUnitVal=function(selector,el){var mainID=el.attr("data-id");var unitVal;if(el.find(selector).hasClass("redux-css-margin")){unitVal=el.find("#"+mainID).data("margin-unit")}if(el.find(selector).hasClass("redux-css-border")){unitVal=el.find("#"+mainID).data("border-unit")}if(el.find(selector).hasClass("redux-css-padding")){unitVal=el.find("#"+mainID).data("padding-unit")}if(el.find(selector).hasClass("redux-css-layout-input-radius")){unitVal=el.find("#"+mainID).data("radius-unit")}return unitVal}})(jQuery);