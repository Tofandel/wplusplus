!function(e){"use strict";redux.field_objects=redux.field_objects||{},redux.field_objects.typography=redux.field_objects.typography||{};var t=[],a=!1,r=!0;redux.field_objects.typography.init=function(s,o){s||(s=e(document).find(".redux-group-tab:visible").find(".redux-container-typography:visible")),e(s).each(function(){var s=e(this),o=s;s.hasClass("redux-field-container")||(o=s.parents(".redux-field-container:first")),o.is(":hidden")||o.hasClass("redux-field-init")&&(o.removeClass("redux-field-init"),void 0===redux.field_objects.pro&&(r=!1),s.each(function(){s.parents(".redux-container").data("opt-name");e(this).find(".redux-typography-container").each(function(){var o=e(this).find(".redux-typography-family"),i=o.data("value");void 0===i?o=e(this):""!==i&&e(o).val(i);var p=[{id:"none",text:"none"}],d=e(this).find(".redux-typography-family").parents(".redux-container-typography:first").data("id"),n=e("#"+d+" .redux-typography-font-family").data("user-fonts");n=n?1:0;var l=e("#"+d+" .redux-typography-google").val();l=l?1:0;var y=[];if(void 0!==redux.optName.customfonts&&y.push(redux.optName.customfonts),void 0!==redux.optName.typekitfonts&&y.push(redux.optName.typekitfonts),void 0!==redux.optName.stdfonts&&0===n&&y.push(redux.optName.stdfonts),1===n){var u=[];for(var g in redux.optName.typography[d]){var h=redux.optName.typography[d].std_font;for(var f in h)h.hasOwnProperty(f)&&u.push({id:f,text:f,"data-google":"false"})}var c={text:"Standard Fonts",children:u};y.push(c)}(1===l||l===!0&&void 0!==redux.optName.googlefonts)&&y.push(redux.optName.googlefonts),p=y;var x=e(this).find(".redux-typography-family").data("value");e(this).find(".redux-typography-family").select2({data:p}),e(this).find(".redux-typography-family").val(x).trigger("change");var v=s.find(".redux-typography-family");v.hasClass("redux-typography-family")||s.find(".redux-typography-style").select2(),e(this).find(".redux-typography-align").select2(),e(this).find(".redux-typography-family-backup").select2(),e(this).find(".redux-typography-transform").select2(),e(this).find(".redux-typography-font-variant").select2(),e(this).find(".redux-typography-decoration").select2(),redux.field_objects.typography.select(o,!0,!1,null,!0),e(this).find(".redux-typography-family, .redux-typography-family-backup, .redux-typography-style, .redux-typography-subsets, .redux-typography-align").on("change",function(r){var s=e(this).attr("id"),o=e("#"+s);if(e(this).hasClass("redux-typography-family")){if(o.val()){var i,p=e(this).select2("data");i=p?p[0].text:null,o.data("value",i),t=p[0],a=!0,redux.field_objects.typography.select(o,!0,!1,i,!0)}}else r=o.val(),o.data("value",r),(e(this).hasClass("redux-typography-align")||e(this).hasClass("redux-typography-subsets")||e(this).hasClass("redux-typography-family-backup")||e(this).hasClass("redux-typography-transform")||e(this).hasClass("redux-typography-font-variant")||e(this).hasClass("redux-typography-decoration"))&&(o.find('option[selected="selected"]').removeAttr("selected"),o.find('option[value="'+r+'"]').attr("selected","selected")),e(this).hasClass("redux-typography-subsets")&&o.siblings(".typography-subsets").val(r),redux.field_objects.typography.select(e(this),!0,!1,null,!1)}),e(this).find(".redux-typography-size, .redux-typography-height, .redux-typography-word, .redux-typography-letter").keyup(function(){redux.field_objects.typography.select(e(this).parents(".redux-container-typography:first"))}),r&&(redux.field_objects.pro.typography.fieldChange(e(this)),redux.field_objects.pro.typography.colorPicker(e(this))),e(this).find(".redux-typography-color").wpColorPicker({change:function(t,a){e(this).val(a.color.toString()),redux.field_objects.typography.select(e(this).parents(".redux-container-typography:first"))}}),e(this).find(".redux-typography-size").numeric({allowMinus:!1}),e(this).find(".redux-typography-height, .redux-typography-word, .redux-typography-letter").numeric({allowMinus:!0});var m=e(this).find(".redux-typography");m.on("select2:unselecting",function(){var t=e(this).data("select2").options;t.set("disabled",!0),setTimeout(function(){t.set("disabled",!1)},1);var a=e(this).attr("id"),r=e("#"+a);r.data("value",""),e(this).hasClass("redux-typography-family")?(e(this).val(null).trigger("change"),redux.field_objects.typography.select(r,!0,!1,null,!0)):((e(this).hasClass("redux-typography-align")||e(this).hasClass("redux-typography-subsets")||e(this).hasClass("redux-typography-family-backup")||e(this).hasClass("redux-typography-transform")||e(this).hasClass("redux-typography-font-variant")||e(this).hasClass("redux-typography-decoration"))&&e("#"+a+' option[selected="selected"]').removeAttr("selected"),e(this).hasClass("redux-typography-subsets")&&r.siblings(".typography-subsets").val(""),e(this).hasClass("redux-typography-family-backup")&&r.val(null).trigger("change"),redux.field_objects.typography.select(e(this),!0,!1,null,!1))}),redux.field_objects.typography.updates(e(this)),window.onbeforeunload=null})}))})},redux.field_objects.typography.updates=function(t){t.find(".update-google-fonts").bind("click",function(a){var r=e(this).data("action"),s=e(this).parent().parent(),o=s.attr("data-nonce");return s.find("p").text(redux_ajax_script.update_google_fonts.updating),s.find("p").attr("aria-label",redux_ajax_script.update_google_fonts.updating),s.removeClass("updating-message updated-message notice-success notice-warning notice-error").addClass("update-message notice-warning updating-message"),e.ajax({type:"post",dataType:"json",url:redux_ajax_script.ajaxurl,data:{action:"redux_update_google_fonts",nonce:o,data:r},error:function(e){console.log(e),s.removeClass("notice-warning updating-message updated-message notice-success").addClass("notice-error");var a=e.error;a&&(a=': "'+a+'"'),s.find("p").html(redux_ajax_script.update_google_fonts.error.replace("%s",r).replace("%msg",a)),s.find("p").attr("aria-label",redux_ajax_script.update_google_fonts.error),redux.field_objects.typography.updates(t)},success:function(a){if(console.log(a),"success"===a.status)s.find("p").html(redux_ajax_script.update_google_fonts.success),s.find("p").attr("aria-label",redux_ajax_script.update_google_fonts.success),s.removeClass("updating-message notice-warning").addClass("updated-message notice-success"),e(".redux-update-google-fonts").not(".notice-success").remove();else{s.removeClass("notice-warning updating-message updated-message notice-success").addClass("notice-error");var o=a.error;o&&(o=': "'+o+'"'),s.find("p").html(redux_ajax_script.update_google_fonts.error.replace("%s",r).replace("%msg",o)),s.find("p").attr("aria-label",redux_ajax_script.update_google_fonts.error),redux.field_objects.typography.updates(t)}}}),a.preventDefault(),!1})},redux.field_objects.typography.size=function(e){var t,a=0;for(t in e)e.hasOwnProperty(t)&&a++;return a},redux.field_objects.typography.makeBool=function(e){return"false"!==e&&"0"!==e&&e!==!1&&0!==e&&("true"===e||"1"===e||e===!0||1===e||void 0)},redux.field_objects.typography.contrastColour=function(e){var t="#444444";if(""!==e){e=e.replace("#","");var a=parseInt(e.substr(0,2),16),r=parseInt(e.substr(2,2),16),s=parseInt(e.substr(4,2),16),o=(299*a+587*r+114*s)/1e3;t=o>=128?"#444444":"#ffffff"}return t},redux.field_objects.typography.select=function(s,o,i,p,d){var n;n=e(s).parents(".redux-container-typography:first").data("id"),void 0===n&&(n=e(s).data("id"));var l=e("#"+n),y=e("#"+n+"-family").val();y||(y=null),p&&(y=p);var u,g=l.find("select.redux-typography-family-backup").val(),h=l.find(".redux-typography-size").val(),f=l.find(".redux-typography-height").val(),c=l.find(".redux-typography-word").val(),x=l.find(".redux-typography-letter").val(),v=l.find("select.redux-typography-align").val(),m=l.find("select.redux-typography-transform").val(),b=l.find("select.redux-typography-font-variant").val(),_=l.find("select.redux-typography-decoration").val(),j=l.find("select.redux-typography-style").val(),C=l.find("select.redux-typography-subsets").val(),w=l.find(".redux-typography-color").val(),k=l.data("units");if(a===!0?(u=redux.field_objects.typography.makeBool(t["data-google"]),l.find(".redux-typography-google-font").val(u)):u=redux.field_objects.typography.makeBool(l.find(".redux-typography-google-font").val()),d){l.hasClass("typography-initialized")||(j=l.find("select.redux-typography-style").data("value"),C=l.find("select.redux-typography-subsets").data("value"),""!==j&&(j=String(j)),void 0!==typeof C&&(C=String(C))),void 0===redux.optName.fonts.google&&(u=!1);var N=!1,z="";if(u===!0&&y in redux.optName.fonts.google?z=redux.optName.fonts.google[y]:void 0!==redux.optName.fonts.typekit&&y in redux.optName.fonts.typekit?(N=!0,z=redux.optName.fonts.typekit[y]):z={400:"Normal 400",700:"Bold 700","400italic":"Normal 400 Italic","700italic":"Bold 700 Italic"},e(s).hasClass("redux-typography-subsets")&&l.find("input.typography-subsets").val(C),e(s).hasClass("redux-typography-family")){var I='<option value=""></option>',O="";u===!0?(e.each(z.variants,function(e,t){t.id===j||1===redux.field_objects.typography.size(z.variants)?(O=' selected="selected"',j=t.id):O="",I+='<option value="'+t.id+'"'+O+">"+t.name.replace(/\+/g," ")+"</option>"}),i&&l.find(".redux-typography-style").select2("destroy"),l.find(".redux-typography-style").html(I).select2(),O="",I='<option value=""></option>',e.each(z.subsets,function(e,t){t.id===C||1===redux.field_objects.typography.size(z.subsets)?(O=' selected="selected"',C=t.id,l.find("input.typography-subsets").val(C)):O="",I+='<option value="'+t.id+'"'+O+">"+t.name.replace(/\+/g," ")+"</option>"}),i&&l.find(".redux-typography-subsets").select2("destroy"),l.find(".redux-typography-subsets").html(I).select2(),l.find(".redux-typography-subsets").parent().fadeIn("fast"),l.find(".typography-family-backup").fadeIn("fast")):N===!0?(e.each(z.variants,function(e,t){t.id===j||1===redux.field_objects.typography.size(z.variants)?(O=' selected="selected"',j=t.id):O="",I+='<option value="'+t.id+'"'+O+">"+t.name.replace(/\+/g," ")+"</option>"}),l.find(".redux-typography-style").select2("destroy"),l.find(".redux-typography-style").html(I).select2(),l.find(".redux-typography-subsets").parent().fadeOut("fast"),l.find(".typography-family-backup").fadeOut("fast")):z&&(e.each(z,function(e,t){e===j||"normal"===e?(O=' selected="selected"',l.find(".typography-style select2-selection__rendered").text(t)):O="",I+='<option value="'+e+'"'+O+">"+t.replace("+"," ")+"</option>"}),i&&l.find(".redux-typography-style").select2("destroy"),l.find(".redux-typography-style").html(I).select2(),l.find(".redux-typography-subsets").parent().fadeOut("fast"),l.find(".typography-family-backup").fadeOut("fast")),l.find(".redux-typography-font-family").val(y)}else e(s).hasClass("redux-typography-family-backup")&&""!==g&&l.find(".redux-typography-font-family-backup").val(g)}d&&(0===l.find("select.redux-typography-style option[value='"+j+"']").length?(j="",l.find("select.redux-typography-style").val("").trigger("change")):"400"===j&&l.find("select.redux-typography-style").val(j).trigger("change"),0===l.find("select.redux-typography-subsets option[value='"+C+"']").length&&(C="",l.find("select.redux-typography-subsets").val("").trigger("change"),l.find("input.typography-subsets").val(C)));var B="style_link_"+n;if(e("."+B).remove(),null!==y&&"inherit"!==y&&l.hasClass("typography-initialized")){var S=y.replace(/\s+/g,"+");if(u===!0){var F=S;j&&""!==j&&(F+=":"+j.replace(/\-/g," ")),C&&""!==C&&(F+="&subset="+C),a===!1&&"undefined"!=typeof WebFont&&WebFont&&WebFont.load({google:{families:[F]}}),l.find(".redux-typography-google").val(!0)}else l.find(".redux-typography-google").val(!1)}if(j.indexOf("italic")!==-1?(l.find(".typography-preview").css("font-style","italic"),l.find(".typography-font-style").val("italic"),j=j.replace("italic","")):(l.find(".typography-preview").css("font-style","normal"),l.find(".typography-font-style").val("")),l.find(".typography-font-weight").val(j),f||(f=h),""===h||void 0===h?l.find(".typography-font-size").val(""):l.find(".typography-font-size").val(h+k),""===f||void 0===f?l.find(".typography-line-height").val(""):l.find(".typography-line-height").val(f+k),""===c||void 0===c?l.find(".typography-word-spacing").val(""):l.find(".typography-word-spacing").val(c+k),""===x||void 0===x?l.find(".typography-letter-spacing").val(""):l.find(".typography-letter-spacing").val(x+k),r&&redux.field_objects.pro.typography.select(n),l.hasClass("typography-initialized")){var P=l.find(".typography-preview").data("preview-size");0===P&&l.find(".typography-preview").css("font-size",h+k),l.find(".typography-preview").css({"font-weight":j,"text-align":v,"font-family":y+", sans-serif"}),"none"===y&&""===y&&l.find(".typography-preview").css("font-family","inherit"),l.find(".typography-preview").css({"line-height":f+k,"word-spacing":c+k,"letter-spacing":x+k}),w&&l.find(".typography-preview").css("color",w),r&&redux.field_objects.typography.previewShadow(n),l.find(".typography-style select2-selection__rendered").text(l.find(".redux-typography-style option:selected").text()),l.find(".typography-script select2-selection__rendered").text(l.find(".redux-typography-subsets option:selected").text()),v&&l.find(".typography-preview").css("text-align",v),m&&l.find(".typography-preview").css("text-transform",m),b&&l.find(".typography-preview").css("font-variant",b),_&&l.find(".typography-preview").css("text-decoration",_),l.find(".typography-preview").slideDown()}l.hasClass("typography-initialized")||l.addClass("typography-initialized"),a=!1,o||redux_change(s)}}(jQuery);